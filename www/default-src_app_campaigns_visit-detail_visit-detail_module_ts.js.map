{"version":3,"sources":["./src/app/campaigns/visit-detail/visit-detail-routing.module.ts","./src/app/campaigns/visit-detail/visit-detail.module.ts","./src/app/campaigns/visit-detail/visit-detail.page.ts","./src/app/campaigns/visit-detail/visit-detail.page.scss","./src/app/campaigns/visit-detail/visit-detail.page.html"],"names":[],"mappings":"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","file":"default-src_app_campaigns_visit-detail_visit-detail_module_ts.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { VisitDetailPage } from './visit-detail.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: VisitDetailPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class VisitDetailPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { VisitDetailPageRoutingModule } from './visit-detail-routing.module';\n\nimport { VisitDetailPage } from './visit-detail.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    VisitDetailPageRoutingModule\n  ],\n  declarations: [VisitDetailPage]\n})\nexport class VisitDetailPageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { Campaign, Visit } from '../campaign.model';\nimport { CampaignsService } from '../campaigns.service';\nimport { ActionSheetController } from '@ionic/angular';\nimport { UserPhoto, PhotoService } from '../photo.service';\nimport { AlertController } from '@ionic/angular';\nimport { FirebaseService } from 'src/app/services/firebase.service';\nimport { AngularFirestore, AngularFirestoreDocument } from '@angular/fire/compat/firestore';\n\n\n@Component({\n  selector: 'app-visit-detail',\n  templateUrl: './visit-detail.page.html',\n  styleUrls: ['./visit-detail.page.scss'],\n})\nexport class VisitDetailPage implements OnInit {\n\n  campaign: Campaign = {    \n    id: '',\n    title: '',\n    code: '',\n    resume: '',\n    imageURL: '',\n    date_start: '',\n    date_end: '',\n    people_on_charge: '',\n    visits: null\n  } \n\n  visit: Visit = {\n        id: '',\n        title: '',\n        code: '',\n        date: '',\n        people_on_charge: '',\n        geoposition: '',\n        questionary: null,\n        photos: null\n  }\n\n\n  campaignId: string\n  visitId: string\n\n  constructor( private activatedRoute: ActivatedRoute, \n    private campaignsService: CampaignsService,\n    public photoService: PhotoService, \n    public actionSheetController: ActionSheetController, \n    public router: Router,\n    private alertCtrl:AlertController, \n    private firebaseService: FirebaseService,\n    private angularFirestore: AngularFirestore) { }\n\n  public goToPage( page:string, photo: UserPhoto, position: number ){\n    this.router.navigate( [page] )\n  }\n\n  async ngOnInit() {\n    this.activatedRoute.paramMap.subscribe( paramMap => {\n      //redirect\n      this.campaignId = paramMap.get('campaignId')\n      this.visitId = paramMap.get('visitId')\n      //this.visit = this.campaignsService.getVisit(this.campaignId, this.visitId)\n    })\n\n    const pathC = '/campaigns/'+this.campaignId\n    this.firebaseService.getDocument<Campaign>(pathC).subscribe( value => {\n      this.campaign = value\n    });\n\n    const path = '/campaigns/'+this.campaignId+'/visits/'+this.visitId\n    this.firebaseService.getDocument<Visit>(path).subscribe( value => {\n      this.visit = value\n      console.log('read photos',this.campaign.code,this.visit.code)\n\n      this.photoService.loadSaved(this.campaign.code,this.visit.code);\n\n    });\n\n  }\n\n  ionViewWillEnter(){\n    this.photoService.loadSaved(this.campaign.code,this.visit.code);\n    //this.campaigns = this.campaignService.getCampaigns()\n  }\n\n\n  public applyQuestionary(){\n    this.router.navigate(['/home/',this.campaignId, this.visitId])\n  }\n\n  public async updateGPS(){\n    const alertElement = await this.alertCtrl.create({\n      header: '¿Actualizar GPS?',\n      message: 'Se intentará encontrar la posición del lugar.',\n      buttons: [\n        {\n          text: 'Cancel',\n          role: 'cancel'\n        },\n        {\n          text: 'Actualizar',\n          handler: () => {\n            this.campaignsService.updateGPS()\n            this.visit.geoposition = this.campaignsService.lat + \" \"+ this.campaignsService.lon\n            \n            //this.campaignsService.saveLabels()\n            const link = '/campaigns/'+this.campaignId+'/visits/'+this.visitId\n\n            const doc: AngularFirestoreDocument<Visit> = this.angularFirestore.doc(link);\n            doc.update(this.visit).then(res =>  {\n              this.router.navigate(['/campaigns',this.campaignId, this.visitId])\n            }).catch( err => {\n              console.log('Error de firebase -> ',err)\n              this.router.navigate(['/error-firebase'])\n            });\n\n\n          }\n        }\n      ]\n    });\n\n    await alertElement.present();\n\n  }\n\n  public showPhoto(photo: UserPhoto, position: number) {\n    this.router.navigate(['/show-photo', this.campaignId, this.visitId, photo.filepath, position ])\n  }\n\n  public async showActionSheet(photo: UserPhoto, position: number) {\n    const actionSheet = await this.actionSheetController.create({\n      header: 'Photos',\n      buttons: [{\n        text: 'Borrar',\n        role: 'destructive',\n        icon: 'trash',\n        handler: () => {\n          this.photoService.deletePicture(photo, position,this.campaignId,this.visitId);\n        }\n      }, {\n        text: 'Cancelar',\n        icon: 'close',\n        role: 'cancel',\n        handler: () => {\n          // Nothing to do, action sheet is automatically closed\n         }\n      }]\n    });\n    await actionSheet.present();\n  }\n\n  public async takePhoto(){\n    this.photoService.addNewToGallery(this.campaign.code,this.visit.code, this.campaignId,this.visitId)\n  }\n    \n  public async deleteVisit(){\n    const alertElement = await this.alertCtrl.create({\n      header: '¿Eliminar la visita?',\n      message: 'La información no podrá ser recuperada.',\n      buttons: [\n        {\n          text: 'Cancel',\n          role: 'cancel'\n        },\n        {\n          text: 'Eliminar',\n          handler: () => {\n            //this.campaignsService.deleteVisit(this.campaignId, this.visitId)\n            const path = '/campaigns/'+this.campaignId+'/visits/'+this.visitId            \n            this.firebaseService.deleteDocument(path).then( res=>{\n              this.router.navigate(['/campaigns',this.campaignId])\n            });\n            \n          }\n        }\n      ]\n    });\n\n    await alertElement.present();\n  }\n\n\n  \n}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJ2aXNpdC1kZXRhaWwucGFnZS5zY3NzIn0= */\";","export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-back-button defaultHref=\\\"/campaigns/{{ campaignId }}\\\"></ion-back-button>\\n    </ion-buttons>\\n    <ion-title> {{ visit.title }}</ion-title>\\n    <ion-buttons slot=\\\"end\\\">\\n      <ion-button (click)=\\\"deleteVisit()\\\" >\\n        <ion-icon name=\\\"trash\\\"></ion-icon>\\n      </ion-button>\\n    </ion-buttons>\\n  </ion-toolbar>\\n\\n  \\n</ion-header>\\n\\n<ion-content>\\n<ion-grid class=\\\"ion-no-padding\\\">\\n  <ion-row>\\n    <ion-col class=\\\"ion-no-padding\\\" *ngIf=\\\"photoService.photos && photoService.photos.length > 0; else noPhoto\\\">\\n     <ion-img [src]=\\\"photoService.photos[0].webviewPath\\\"></ion-img> \\n    </ion-col>\\n    <ng-template #noPhoto>\\n      <ion-col class=\\\"ion-no-padding\\\">\\n      <p class=\\\"ion-text-center\\\"> Sin fotos</p>\\n    </ion-col>\\n    </ng-template>\\n  </ion-row>\\n  <ion-row>\\n    <ion-col>\\n      <h1 class=\\\"ion-text-center\\\"> {{ visit.title}} [{{visit.code}}] </h1>      \\n      <p class=\\\"ion-text-center\\\"> {{ visit.geoposition }}</p>\\n      <p class=\\\"ion-text-center\\\"> {{ visit.date }}</p>\\n      <p class=\\\"ion-text-center\\\"> {{ visit.people_on_charge}}</p>\\n    </ion-col>\\n  </ion-row>\\n</ion-grid>\\n<ion-grid class=\\\"ion-no-padding\\\">\\n  <ion-row>\\n    <ion-col class=\\\"ion-no-padding, ion-text-center\\\">\\n      <ion-button (click)=\\\"updateGPS()\\\">\\n        <ion-icon size=\\\"large\\\" name=\\\"earth-outline\\\"></ion-icon>\\n      </ion-button>\\n    </ion-col>\\n    <ion-col class=\\\"ion-no-padding, ion-text-center\\\">\\n      <ion-button (click)=\\\"takePhoto()\\\">\\n        <ion-icon size=\\\"large\\\" name=\\\"camera-outline\\\"></ion-icon>\\n      </ion-button>\\n    </ion-col>\\n    <ion-col class=\\\"ion-no-padding, ion-text-center\\\">\\n      <ion-button (click)=\\\"applyQuestionary()\\\">\\n        <ion-icon size=\\\"large\\\" name=\\\"book-outline\\\"></ion-icon>\\n      </ion-button>\\n    </ion-col>\\n  </ion-row>\\n  \\n  <ion-grid>\\n    <ion-row>\\n    <ion-col size=\\\"6\\\" *ngFor=\\\"let photo of photoService.photos; index as position\\\">\\n      <ion-img [src]=\\\"photo.webviewPath\\\" (click)=\\\"showPhoto(photo, position)\\\"></ion-img>\\n    </ion-col>\\n    </ion-row>\\n  </ion-grid>\\n\\n</ion-grid>\\n</ion-content>\\n\";"],"sourceRoot":"webpack:///"}